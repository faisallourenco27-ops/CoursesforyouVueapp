<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses for you</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Courseforyouapp.css">

    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script src="vueCourseforyouapp.js?v=2" defer></script>
</head>
<body>

<div id="app">
    <div class="container">

        <header>
            <h1><i class="fas fa-graduation-cap"></i> Courses for you</h1>
        </header>

        <!--  LESSONS PAGE -->
        <div v-if="!showCartPage && !showAdminPage">

            <!-- Sorting + Search Controls -->
            <div class="controls">

                <div class="sort-controls">
                    <label><strong>Sort by:</strong></label>
                    <select v-model="sortBy">
                        <option value="lesson">Lesson</option>
                        <option value="location">Location</option>
                        <option value="price">Price</option>
                        <option value="spaces">Available Spaces</option>
                    </select>

                    <label><strong>Order:</strong></label>
                    <select v-model="sortOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>

                <!-- Search Bar -->
                    <div class="search-bar">
                     <input 
                            type="text"
                            v-model="searchQuery"
                            placeholder="Search lessons or locations..."
                    >
                    <i class="fas fa-search search-icon"></i>
                </div>


            </div>

            <!-- Cart Summary -->
            <div class="cart-summary">
                <strong>Cart: {{ cartCount }} items</strong>

                <button class="view-cart-btn" @click="viewCart()">
                    <i class="fas fa-shopping-cart"></i> View Cart
                </button>

                <button class="view-cart-btn" @click="openAdmin()">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
            </div>

            <!-- Lessons Grid -->
            <div class="lessons-grid">
                <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-card">

                    <div class="lesson-icon">
                        <img :src="lesson.icon" :alt="lesson.lesson">
                    </div>

                    <div class="lesson-detail">
                        <strong>Lesson:</strong>
                        <span>{{ lesson.lesson }}</span>
                    </div>

                    <div class="lesson-detail">
                        <strong>Location:</strong>
                        <span>{{ lesson.location }}</span>
                    </div>

                    <div class="lesson-detail">
                        <strong>Price:</strong>
                        <span>£{{ lesson.price }}</span>
                    </div>

                    <div class="lesson-detail">
                        <strong>Spaces:</strong>
                        <span>{{ lesson.spaces }} available</span>
                    </div>

                    <button class="more-info-btn"
                        @click="showLessonInfo(lesson)">
                        <i class="fas fa-info-circle"></i> More Info
                    </button>

                    <button class="add-to-cart-btn"
                        @click="addToCart(lesson)"
                        :disabled="lesson.spaces === 0">
                        <i class="fas fa-cart-plus"></i>
                        {{ lesson.spaces > 0 ? 'Add to Cart' : 'No Spaces Available' }}
                    </button>

                </div>
            </div>

        </div> <!-- END LESSONS PAGE -->



        <!--  CART PAGE -->
        <div v-else-if="showCartPage" class="cart-page">

            <div class="cart-header">
                <button class="back-btn" @click="backToLessons()">
                    <i class="fas fa-arrow-left"></i> Back to Lessons
                </button>
                <h2>Shopping Cart</h2>
            </div>

            <!-- Empty Cart -->
            <div v-if="cart.length === 0 && !showOrderConfirmation" class="empty-cart">
                <p>Your cart is empty</p>
            </div>

            <!-- Cart Items -->
            <div v-else class="cart-items">

                <div v-for="item in cart" :key="item.id" class="cart-item">

                    <div class="item-details">
                        <h3>{{ item.lesson }}</h3>
                        <p>Location: {{ item.location }}</p>
                        <p>Price: £{{ item.price }} each</p>

                        <!-- Quantity Editor -->
                        <div class="quantity-controls">
                            <strong>Quantity:</strong>
                            <button class="qty-btn" @click="decreaseQuantity(item)">-</button>
                            <span>{{ item.quantity }}</span>
                            <button class="qty-btn" @click="increaseQuantity(item)">+</button>
                        </div>

                        <p class="item-total">
                            Total: £{{ item.price * item.quantity }}
                        </p>
                    </div>

                    <button class="remove-btn" @click="removeFromCart(item)">
                        <i class="fas fa-trash"></i> Remove
                    </button>

                </div>

                <div class="cart-total">
                    <h3>Total: £{{ cartTotal }}</h3>
                </div>

                <!-- Checkout Section -->
                <div class="checkout-form">

                    <h3>Checkout</h3>

                    <!-- Order Confirmation -->
                    <div v-if="showOrderConfirmation" class="order-confirmation">
                        <i class="fas fa-check-circle"></i>
                        <h3>Order Submitted Successfully!</h3>

                        <p><strong>Order Number:</strong> {{ confirmedOrderDetails.orderNumber }}</p>
                        <p><strong>Thank you, {{ confirmedOrderDetails.name }}!</strong></p>
                        <p>Your order is being processed. We will contact you at {{ confirmedOrderDetails.phone }}.</p>

                        <div class="order-summary">
                            <h4>Order Summary:</h4>
                            <ul>
                                <li v-for="item in confirmedOrderDetails.items" :key="item.id">
                                    {{ item.lesson }} (Qty: {{ item.quantity }}) - £{{ item.price * item.quantity }}
                                </li>
                            </ul>
                            <p><strong>Total: £{{ confirmedOrderDetails.total }}</strong></p>
                        </div>
                    </div>

                    <!-- Checkout Form -->
                    <div v-else>

                        <div class="form-group">
                            <label><strong>Name:</strong></label>
                            <input 
                                type="text"
                                v-model="checkoutName"
                                placeholder="Enter your name"
                                :class="{ 'invalid': checkoutName && !isNameValid }"
                            >
                            <span v-if="checkoutName && !isNameValid" class="error-message">
                                Name must contain letters only
                            </span>
                        </div>

                        <div class="form-group">
                            <label><strong>Phone:</strong></label>
                            <input 
                                type="text"
                                v-model="checkoutPhone"
                                placeholder="Enter your phone number"
                                :class="{ 'invalid': checkoutPhone && !isPhoneValid }"
                            >
                            <span v-if="checkoutPhone && !isPhoneValid" class="error-message">
                                Phone must contain numbers only
                            </span>
                        </div>

                        <button class="checkout-btn"
                            @click="checkout()"
                            :disabled="!isCheckoutEnabled">
                            <i class="fas fa-check"></i> Checkout
                        </button>

                    </div>

                </div>

            </div>

        </div> <!-- END CART PAGE -->



        <!--   ADMIN PAGE -->
        <div v-else class="cart-page admin-page">

            <div class="cart-header">
                <button class="back-btn" @click="closeAdmin()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Admin: Manage Lessons</h2>
            </div>

            <!-- Admin Login -->
            <div v-if="!isAdmin" class="checkout-form">
                <h3>Admin Login</h3>

                <div class="form-group">
                    <label><strong>Username:</strong></label>
                    <input type="text" v-model="adminUsername" placeholder="Enter username">
                </div>

                <div class="form-group">
                    <label><strong>Password:</strong></label>
                    <input type="password" v-model="adminPassword" placeholder="Enter password">
                </div>

                <span v-if="adminError" class="error-message">{{ adminError }}</span>

                <button class="checkout-btn" @click="submitAdminLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>

            <!-- Admin Editing Panel -->
            <div v-else class="lessons-grid">

                <div v-for="lesson in lessons" :key="lesson.id" class="lesson-card">

                    <div class="lesson-detail">
                        <strong>Lesson:</strong> {{ lesson.lesson }}
                    </div>

                    <div class="lesson-detail">
                        <strong>Location:</strong> {{ lesson.location }}
                    </div>

                    <div class="lesson-detail">
                        <strong>Current Spaces:</strong> {{ lesson.spaces }}
                    </div>

                    <div class="form-group">
                        <label><strong>Set New Spaces:</strong></label>
                        <input type="number" min="0" v-model.number="lesson.spaces">
                    </div>

                    <button class="add-to-cart-btn" @click="saveAdminSpaces(lesson)">
                        <i class="fas fa-save"></i> Save
                    </button>

                </div>

            </div>

        </div> <!-- END ADMIN PAGE -->



        <!-- LESSON INFO MODAL -->
        <div v-if="showLessonModal" class="modal-overlay" @click="hideLessonInfo">
            <div class="modal-content" @click.stop>

                <div class="modal-header">
                    <h2>{{ selectedLesson.lesson }}</h2>
                    <button class="close-btn" @click="hideLessonInfo">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="modal-body">

                    <div class="lesson-icon-large">
                        <img :src="selectedLesson.icon" :alt="selectedLesson.lesson">
                    </div>

                    <div class="lesson-details-modal">
                        <div class="detail-row">
                            <strong>Location:</strong>
                            <span>{{ selectedLesson.location }}</span>
                        </div>

                        <div class="detail-row">
                            <strong>Price:</strong>
                            <span>£{{ selectedLesson.price }}</span>
                        </div>

                        <div class="detail-row">
                            <strong>Spaces Available:</strong>
                            <span :class="selectedLesson.spaces > 2 ? 'spaces-available' : 'spaces-low'">
                                {{ selectedLesson.spaces }}
                            </span>
                        </div>
                    </div>

                    <div class="synopsis-section">
                        <h3>About this lesson:</h3>
                        <p class="synopsis-text">{{ selectedLesson.synopsis }}</p>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="add-to-cart-modal-btn"
                        @click="addToCart(selectedLesson); hideLessonInfo();"
                        :disabled="selectedLesson.spaces === 0">
                        <i class="fas fa-cart-plus"></i>
                        {{ selectedLesson.spaces > 0 ? 'Add to Cart' : 'No Spaces Available' }}
                    </button>

                    <button class="close-modal-btn" @click="hideLessonInfo">
                        Close
                    </button>
                </div>

            </div>
        </div>

    </div>
</div>

</body>
</html>
